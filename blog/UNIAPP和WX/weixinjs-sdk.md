# weixinjs-sdk

[微信 JS-SDK](https://developers.weixin.qq.com/doc/offiaccount/Getting_Started/Overview.html)是微信公众平台 面向网页开发者提供的基于微信内的网页开发工具包。

通过使用`微信JS-SDK`，网页开发者可借助微信高效地使用拍照、选图、语音、位置等手机系统的能力，同时可以直接使用微信分享、扫一扫、卡券、支付等微信特有的能力，为微信用户提供更优质的网页体验。

## `js-sdk`使用步骤

1.  绑定域名。\
    先登录微信公众平台进入“公众号设置”的“功能设置”里填写“JS 接口安全域名”。\
    备注：登录后可在“开发者中心”查看对应的接口权限。
2.  引入`JS`文件。\
    在需要调用`JS`接口的页面引入如下`JS`文件，（支持 https）：http://res.wx.qq.com/open/js/jweixin-1.6.0.js。\
    如需进一步提升服务稳定性，当上述资源不可访问时，可改访问：http://res2.wx.qq.com/open/js/jweixin-1.6.0.js （支持 https）。\
    备注：支持使用`AMD/CMD`标准模块加载方法加载。
3.  通过`config`接口注入权限验证配置。\
    所有需要使用`JS-SDK`的页面必须先注入配置信息，否则将无法调用（同一个`url`仅需调用一次，对于变化`url`的`SPA`的`web app`可在每次`url`变化时进行调用，目前`Android`微信客户端不支持`pushState`的`H5`新特性，所以使用`pushState`来实现`web app`的页面会导致签名失败，此问题会在`Android6.2`中修复）。
    ```js
    wx.config({
     debug: true, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
     appId: '', // 必填，公众号的唯一标识
     timestamp: , // 必填，生成签名的时间戳
     nonceStr: '', // 必填，生成签名的随机串
     signature: '',// 必填，签名
     jsApiList: [] // 必填，需要使用的JS接口列表
    });
    ```
4.  通过`ready`接口处理成功验证。\
    ```js
    wx.ready(function () {
      // config信息验证后会执行ready方法，所有接口调用都必须在config接口获得结果之后，config是一个客户端的异步操作，所以如果需要在页面加载时就调用相关接口，则须把相关接口放在ready函数中调用来确保正确执行。对于用户触发时才调用的接口，则可以直接调用，不需要放在ready函数中。
    });
    ```
5.  通过`error`接口处理失败验证。\
    ```js
    wx.error(function (res) {
      // config 信息验证失败会执行 error 函数，如签名过期导致验证失败，具体错误信息可以打开 config 的 debug 模式查看，也可以在返回的 res 参数中查看，对于 SPA 可以在这里更新签名。
    });
    ```

接口调用说明：
所有接口通过`wx`对象(也可使用`jWeixin`对象)来调用，参数是一个对象，除了每个接口本身需要传的参数之外，还有以下通用参数：

1. `success`：接口调用成功时执行的回调函数。
2. `fail`：接口调用失败时执行的回调函数。
3. `complete`：接口调用完成时执行的回调函数，无论成功或失败都会执行。
4. `cancel`：用户点击取消时的回调函数，仅部分有用户取消操作的`api`才会用到。
5. `trigger`：监听`Menu`中的按钮点击时触发的方法，该方法仅支持`Menu`中的相关接口。
   备注：不要尝试在`trigger`中使用`ajax`异步请求修改本次分享的内容，因为客户端分享操作是一个同步操作，这时候使用`ajax`的回包会还没有返回。

以上几个函数都带有一个参数，类型为对象，其中除了每个接口本身返回的数据之外，还有一个通用属性`errMsg`，其值格式如下：

调用成功时：`"xxx:ok"`，其中`xxx`为调用的接口名。

用户取消时：`"xxx:cancel"`，其中`xxx`为调用的接口名。

调用失败时：其值为具体错误信息。
