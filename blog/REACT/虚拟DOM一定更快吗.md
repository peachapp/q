# 虚拟`DOM`一定更快吗

1. 初次渲染的时候，其实并不快。
2. 在更新的时候，更新的元素内容比较少，它可以实现精准的定量更新，不需把全部的`DOM`元素删除重添加。
3. 虚拟`DOM`的优势肯定不是更快，而是：跨平台、增量更新、处理兼容性问题...。

`react`中涉及到虚拟`DOM`的代码主要分为以下三部分，其中核心是第二步的`domDiff`算法：

- 把`render`中的`JSX`（或者`createElement`这个`API`）转化成虚拟`DOM`。
- 状态或属性改变后重新计算虚拟`DOM`并生成一个补丁对象 (`domDiff`)。
- 通过这个补丁对象更新视图中的`DOM`节点。

`DOM`操作是性能杀手，因为操作`DOM`会引起页面的回流或者重绘。相比起来，通过多一些预先计算来减少`DOM`的操作要划算的多。

但是，“使用虚拟`DOM`会更快”这句话并不一定适用于所有场景。例如：一个页面就有一个按钮，点击一下，数字加一，那肯定是直接操作`DOM`更快。使用虚拟`DOM`无非白白增加了计算量和代码量。即使是复杂情况，浏览器也会对我们的`DOM`操作进行优化，大部分浏览器会根据我们操作的时间和次数进行批量处理，所以直接操作`DOM`也未必很慢。

那么为什么现在的框架都使用虚拟`DOM`呢？因为使用虚拟`DOM`可以提高代码的性能下限，并极大的优化大量操作`DOM`时产生的性能损耗。同时这些框架也保证了，即使在少数虚拟`DOM`不太给力的场景下，性能也在我们接受的范围内。

而且，我们之所以喜欢`react`、`vue`等使用了虚拟`DOM`的框架，不光是因为他们快，还有很多其他更重要的原因。例如`react`对函数式编程的友好，`vue`优秀的开发体验等。
