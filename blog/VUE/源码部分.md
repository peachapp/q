# 手写代码实现`vue2`

## 模板解析

```js
class vue {
  constructor(options) {
    this.$el = document.querySelector(options.el);
    this.$data = options.data;

    this.compile(this.$el);
  }

  compile(node) {
    node.childNodes.forEach((item, index) => {
      // 元素节点
      if (item.nodeType == 1) {
        this.compile(item);
      }
      // 节点文本，如果有{{}}就替换成数据
      if (item.nodeType == 3) {
        // 正则匹配{{}}
        let reg = /\{\{(.*?)\}\}/g;
        let text = item.textContent;
        // 给节点赋值

        item.textContent = text.replace(reg, (match, vmKey) => {
          vmKey = vmKey.trim();
          return this.$data[vmKey];
        });
      }
    });
  }
}
```

使用：

```html
<div id="app">
  <h1>{{str}}</h1>
  {{ str }}
</div>

<script>
  new vue({
    el: "#app",
    data: {
      str: "你好",
    },
  });
</script>
```

## 生命周期

```js
class vue {
  constructor(options) {
    if (typeof options.beforeCreate == "function") {
      options.beforeCreate.bind(this)();
    }

    this.$data = options.data;

    if (typeof options.created == "function") {
      options.created.bind(this)();
    }

    if (typeof options.beforeMount == "function") {
      options.beforeMount.bind(this)();
    }

    this.$el = document.querySelector(options.el);

    this.compile(this.$el);

    if (typeof options.mounted == "function") {
      options.mounted.bind(this)();
    }
  }

  compile(node) {
    node.childNodes.forEach((item, index) => {
      // 元素节点
      if (item.nodeType == 1) {
        this.compile(item);
      }
      // 节点文本，如果有{{}}就替换成数据
      if (item.nodeType == 3) {
        // 正则匹配{{}}
        let reg = /\{\{(.*?)\}\}/g;
        let text = item.textContent;
        // 给节点赋值

        item.textContent = text.replace(reg, (match, vmKey) => {
          vmKey = vmKey.trim();
          return this.$data[vmKey];
        });
      }
    });
  }
}
```

使用：

```html
<script>
  new vue({
    el: "#app",
    data: {
      str: "你好",
    },
    beforeCreate() {
      console.log("beforeCreate", this.$el, this.$data);
    },
    created() {
      console.log("created", this.$el, this.$data);
    },
    beforeMount() {
      console.log("beforeMount", this.$el, this.$data);
    },
    mounted() {
      console.log("mounted", this.$el, this.$data);
    },
  });
</script>
```

## 添加事件

https://github.com/peachapp/daily/commit/c48e0523f723e9da724feaa53f9ebb0e03bfabc7

## `data`劫持

https://github.com/peachapp/daily/commit/f2fa06503bf2a755b47d17dfa79c4c2e1c26b2bc

## 更新视图

https://github.com/peachapp/daily/commit/733a720ecaa5811f1a07ea91c52ab075655f6f4c

## `v-model`双向绑定原理

https://github.com/peachapp/daily/commit/f13a1ca6b0136b4318d702ccca8ce4db7f84cfc5

通过`Object.defineProperty`劫持数据发生的改变，如果数据发生了改变（在 set 中进行赋值的），触发 update 方法进行更新节点内容（{{}}），从而实现了数据双向绑定的原理。
